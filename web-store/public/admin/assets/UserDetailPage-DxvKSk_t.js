import{c as n,u as R,a as r,s as f,z as o,j as e,L as i,e as j,n as b,f as y,i as A,P as D}from"./index-B7VyGmnV.js";import{b as B,c as O,d as q,S as I,a as V,u as H}from"./userService-CfcbAx6N.js";import{L as N}from"./loader-circle-DVE6fxfl.js";import{A as W}from"./arrow-left-CyqdG89q.js";const E=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],T=n("calendar",E);const F=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],J=n("phone",F);const X=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],G=n("shopping-bag",X);const K=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Q=n("user",K);const Y=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Z=n("wallet",Y),ee={pending:"badge-pending",paid:"badge-paid",processing:"badge-processing",shipped:"badge-shipped",completed:"badge-completed",cancelled:"badge-cancelled",return_requested:"badge-return_requested",returned:"badge-returned"};function m({icon:a,label:s,value:d,color:c}){return e.jsxs("div",{className:"card flex items-center gap-4",children:[e.jsx("div",{className:`w-11 h-11 rounded-xl flex items-center justify-center shrink-0 ${c}`,children:e.jsx(a,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:d})]})]})}function le(){const{id:a}=R(),[s,d]=r.useState(null),[c,v]=r.useState(0),[_,w]=r.useState(0),[k,S]=r.useState(0),[x,C]=r.useState([]),[z,h]=r.useState(!0),[u,p]=r.useState(!1),g=r.useCallback(async()=>{if(a){h(!0);try{const[t,l,L]=await Promise.all([B(a),O(a),q(a)]);d(t),v(l),S(L);const{data:M}=await f.from("reward_points").select("points").eq("user_id",a).maybeSingle();w(M?.points??0);const{data:P}=await f.from("orders").select("id, total_amount, status, created_at, shipping_address").eq("user_id",a).order("created_at",{ascending:!1}).limit(10);C(P??[])}catch{o.error("Failed to load user details")}finally{h(!1)}}},[a]);r.useEffect(()=>{g()},[g]);const U=async()=>{if(!s)return;const t=s.role==="admin"?"customer":"admin";if(confirm(`Change ${s.full_name}'s role to "${t}"?`)){p(!0);try{await H(s.user_id,t),d(l=>l&&{...l,role:t}),o.success(`Role updated to ${t}`)}catch{o.error("Failed to update role")}finally{p(!1)}}};if(z)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(N,{size:32,className:"animate-spin text-primary"})});if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-3",children:[e.jsx("p",{className:"text-muted-foreground",children:"User not found."}),e.jsx(i,{to:"/users",className:"btn-secondary",children:"Back to Users"})]});const $=s.full_name?.split(" ").map(t=>t[0]).slice(0,2).join("").toUpperCase()??"?";return e.jsxs("div",{className:"space-y-6 max-w-5xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{to:"/users",className:"btn-ghost btn-icon",children:e.jsx(W,{size:18})}),e.jsx("h1",{className:"page-header mb-0",children:"User Detail"})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-5",children:[e.jsxs("div",{className:"relative shrink-0",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.full_name,className:"w-20 h-20 rounded-2xl object-cover border-2 border-border"}):e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-primary/20 border-2 border-primary/30 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-primary",children:$})}),e.jsx("span",{className:j("absolute -bottom-1.5 -right-1.5 badge text-[10px] px-1.5 py-0.5",s.role==="admin"?"bg-primary/20 text-primary border-primary/30":"bg-secondary text-muted-foreground border-border"),children:s.role})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:s.full_name}),s.username&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",s.username]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-x-5 gap-y-1.5",children:[s.phone_number&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(J,{size:13})," ",s.phone_number]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(T,{size:13})," Joined ",b(s.created_at)]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Q,{size:13})," ",s.user_id.slice(0,8).toUpperCase()]})]})]}),e.jsxs("button",{onClick:U,disabled:u,className:j("flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium border transition-all shrink-0",s.role==="admin"?"bg-destructive/10 text-destructive border-destructive/30 hover:bg-destructive/20":"bg-primary/10 text-primary border-primary/30 hover:bg-primary/20"),children:[u?e.jsx(N,{size:14,className:"animate-spin"}):s.role==="admin"?e.jsx(I,{size:14}):e.jsx(V,{size:14}),s.role==="admin"?"Revoke Admin":"Make Admin"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(m,{icon:Z,label:"Wallet Balance",value:y(c),color:"bg-emerald-500/15 text-emerald-400"}),e.jsx(m,{icon:A,label:"Reward Points",value:`${_.toLocaleString("id-ID")} pts`,color:"bg-accent/15 text-accent"}),e.jsx(m,{icon:G,label:"Total Orders",value:k,color:"bg-primary/15 text-primary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-base font-semibold text-foreground flex items-center gap-2",children:[e.jsx(D,{size:16,className:"text-primary"}),"Order History",e.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:"(last 10)"})]}),e.jsx(i,{to:`/orders?user=${a}`,className:"text-xs text-primary hover:underline",children:"View all orders →"})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsxs("tbody",{children:[x.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-12 text-muted-foreground",children:"No orders yet."})}),x.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("span",{className:"font-mono text-xs text-muted-foreground",children:["#",t.id.slice(0,8).toUpperCase()]})}),e.jsx("td",{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:b(t.created_at)})}),e.jsx("td",{children:e.jsx("span",{className:"text-sm font-medium text-foreground",children:y(t.total_amount)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${ee[t.status]??"badge-pending"} capitalize`,children:t.status.replace("_"," ")})}),e.jsx("td",{className:"text-right",children:e.jsx(i,{to:`/orders/${t.id}`,className:"text-xs text-primary hover:underline",children:"View →"})})]},t.id))]})]})})]})]})}export{le as default};
