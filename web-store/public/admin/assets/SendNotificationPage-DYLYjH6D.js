import{c as h,s as m,a as g,j as e,B as j,z as p}from"./index-B7VyGmnV.js";import{u as N,a as b,o as y,s as o,c as u}from"./schemas-DS6lUYcu.js";import{L as v}from"./loader-circle-DVE6fxfl.js";const _=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],S=h("send",_);async function w(s){if(s.user_id){const{error:t}=await m.from("notifications").insert({user_id:s.user_id,title:s.title,message:s.message,type:s.type,action_url:s.action_url,is_read:!1});if(t)throw t}else{const{data:t}=await m.from("profiles").select("user_id").eq("role","customer");if(!t||t.length===0)return;const l=t.map(i=>({user_id:i.user_id,title:s.title,message:s.message,type:s.type,action_url:s.action_url,is_read:!1}));for(let i=0;i<l.length;i+=100){const n=l.slice(i,i+100),{error:r}=await m.from("notifications").insert(n);if(r)throw r}}}const z=y({target:u(["all","specific"]),user_id:o().optional(),type:u(["promo","system","order","wallet"]),title:o().min(1,"Title required"),message:o().min(1,"Message required"),action_url:o().optional()});function I(){const[s,t]=g.useState(!1),{register:l,handleSubmit:i,watch:n,reset:r,formState:{errors:c}}=N({resolver:b(z),defaultValues:{target:"all",type:"promo"}}),d=n("target"),x=async a=>{t(!0);try{await w({title:a.title,message:a.message,type:a.type,action_url:a.action_url,user_id:a.target==="specific"?a.user_id:void 0}),p.success(a.target==="all"?"Notification sent to all customers!":"Notification sent!"),r()}catch(f){p.error(f.message??"Failed to send notification")}finally{t(!1)}};return e.jsxs("div",{className:"max-w-xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{size:22,className:"text-primary"}),e.jsx("h1",{className:"page-header mb-0",children:"Send Notification"})]}),e.jsxs("form",{onSubmit:i(x),className:"card space-y-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Target Audience"}),e.jsx("div",{className:"flex gap-3",children:[{value:"all",label:"All Customers"},{value:"specific",label:"Specific User"}].map(a=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",...l("target"),value:a.value,className:"accent-primary"}),e.jsx("span",{className:"text-sm text-foreground",children:a.label})]},a.value))})]}),d==="specific"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"User ID"}),e.jsx("input",{...l("user_id"),className:"input",placeholder:"Paste user UUID from the Users page"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Notification Type"}),e.jsxs("select",{...l("type"),className:"select",children:[e.jsx("option",{value:"promo",children:"üéâ Promo"}),e.jsx("option",{value:"system",children:"‚öôÔ∏è System"}),e.jsx("option",{value:"order",children:"üì¶ Order"}),e.jsx("option",{value:"wallet",children:"üí∞ Wallet"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Title *"}),e.jsx("input",{...l("title"),className:"input",placeholder:"e.g. Special Batik Weekend Sale!"}),c.title&&e.jsx("p",{className:"text-xs text-destructive",children:c.title.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Message *"}),e.jsx("textarea",{...l("message"),rows:3,className:"input resize-none",placeholder:"Write the notification body here. Keep it concise and engaging."}),c.message&&e.jsx("p",{className:"text-xs text-destructive",children:c.message.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Action URL (optional)"}),e.jsx("input",{...l("action_url"),className:"input",placeholder:"e.g. /products or /vouchers"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Deep link in the mobile app when the user taps the notification."})]}),e.jsx("div",{className:"pt-2 border-t border-border",children:e.jsxs("button",{type:"submit",disabled:s,className:"btn-primary w-full",children:[s?e.jsx(v,{size:16,className:"animate-spin"}):e.jsx(S,{size:16}),s?"Sending...":d==="all"?"Send to All Customers":"Send Notification"]})})]})]})}export{I as default};
