import{u as E,m as R,a as c,j as e,L as S,e as D,z as l}from"./index-B7VyGmnV.js";import{u as B,a as $,o as K,s as n,p as g,n as h,b as P}from"./schemas-DS6lUYcu.js";import{g as M}from"./categoryService-xXKv2Z8A.js";import{b as O,c as V,u as X,e as G}from"./productService-Dr9A4P09.js";import{L as f}from"./loader-circle-DVE6fxfl.js";import{A as H}from"./arrow-left-CyqdG89q.js";import{X as J}from"./x-B1ujcCVc.js";import{U as Q}from"./upload-CeYHQV_O.js";import{S as T}from"./save-D7_vrgA4.js";const b=a=>a===""||a===null||a===void 0?void 0:Number(a),W=K({name:n().min(1,"Name is required"),description:n().optional(),price:g(b,h().min(1,"Price must be greater than 0")),original_price:g(b,h().optional()),stock:g(b,h().min(0,"Stock cannot be negative")),category_id:n().min(1,"Category is required"),material:n().optional(),is_featured:P(),is_active:P()});function le(){const{id:a}=E(),_=R(),o=!!a,j=c.useRef(null),[k,w]=c.useState([]),[d,m]=c.useState([]),[u,N]=c.useState(!1),[I,C]=c.useState(o),[y,v]=c.useState(!1),{register:t,handleSubmit:z,reset:F,formState:{errors:i}}=B({resolver:$(W),defaultValues:{is_featured:!1,is_active:!0}});c.useEffect(()=>{M().then(w),o&&a&&O(a).then(s=>{s&&(F({name:s.name,description:s.description??"",price:s.price,original_price:s.original_price,stock:s.stock,category_id:s.category_id,material:s.material??"",is_featured:s.is_featured,is_active:s.is_active}),m(s.images??[])),C(!1)})},[a]);const L=async s=>{const r=Array.from(s.target.files??[]);if(r.length!==0){N(!0);try{const p=a??`temp-${Date.now()}`,A=await Promise.all(r.map(x=>V(x,p)));m(x=>[...x,...A]),l.success(`${r.length} image(s) uploaded`)}catch{l.error("Image upload failed")}finally{N(!1)}}},U=s=>m(r=>r.filter(p=>p!==s)),q=async s=>{if(d.length===0){l.error("At least one product image is required");return}v(!0);try{const r={...s,images:d};o&&a?(await X(a,r),l.success("Product updated successfully")):(await G(r),l.success("Product created successfully")),_("/products")}catch(r){l.error(r.message??"Failed to save product")}finally{v(!1)}};return I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(f,{size:32,className:"animate-spin text-primary"})}):e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{to:"/products",className:"btn-ghost btn-icon",children:e.jsx(H,{size:18})}),e.jsx("h1",{className:"page-header mb-0",children:o?"Edit Product":"New Product"})]}),e.jsxs("form",{onSubmit:z(q),className:"space-y-6",children:[e.jsxs("div",{className:"card space-y-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground border-b border-border pb-3",children:"Basic Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Product Name *"}),e.jsx("input",{...t("name"),className:"input",placeholder:"e.g. Sarung Songket Premium"}),i.name&&e.jsx("p",{className:"text-xs text-destructive",children:i.name.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{...t("description"),rows:4,className:"input resize-none",placeholder:"Describe the product material, origin, usage..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Category *"}),e.jsxs("select",{...t("category_id"),className:"select",children:[e.jsx("option",{value:"",children:"Select category"}),k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),i.category_id&&e.jsx("p",{className:"text-xs text-destructive",children:i.category_id.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Material"}),e.jsx("input",{...t("material"),className:"input",placeholder:"e.g. Sutra, Katun"})]})]})]}),e.jsxs("div",{className:"card space-y-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground border-b border-border pb-3",children:"Pricing & Inventory"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Price (Rp) *"}),e.jsx("input",{...t("price"),type:"number",className:"input",placeholder:"200000"}),i.price&&e.jsx("p",{className:"text-xs text-destructive",children:i.price.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Original Price (Rp)"}),e.jsx("input",{...t("original_price"),type:"number",className:"input",placeholder:"250000"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Stock *"}),e.jsx("input",{...t("stock"),type:"number",className:"input",placeholder:"100"}),i.stock&&e.jsx("p",{className:"text-xs text-destructive",children:i.stock.message})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...t("is_active"),className:"w-4 h-4 rounded accent-primary"}),e.jsx("span",{className:"text-sm text-foreground",children:"Active (visible in app)"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...t("is_featured"),className:"w-4 h-4 rounded accent-primary"}),e.jsx("span",{className:"text-sm text-foreground",children:"Featured (Flash Deals)"})]})]})]}),e.jsxs("div",{className:"card space-y-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground border-b border-border pb-3",children:"Product Images"}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-3",children:[d.map(s=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden border border-border group",children:[e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>U(s),className:`absolute top-1 right-1 w-6 h-6 bg-destructive rounded-full flex items-center justify-center\r
                             opacity-0 group-hover:opacity-100 transition-opacity`,children:e.jsx(J,{size:12,className:"text-white"})})]},s)),e.jsx("button",{type:"button",onClick:()=>j.current?.click(),disabled:u,className:D("aspect-square rounded-lg border-2 border-dashed border-border flex flex-col items-center justify-center gap-1","hover:border-primary hover:bg-primary/5 transition-colors text-muted-foreground hover:text-primary",u&&"opacity-50 cursor-wait"),children:u?e.jsx(f,{size:20,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:20}),e.jsx("span",{className:"text-xs",children:"Upload"})]})})]}),e.jsx("input",{ref:j,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:L}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upload to Supabase Storage. First image is the thumbnail."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(S,{to:"/products",className:"btn-secondary",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:y,className:"btn-primary",children:[y?e.jsx(f,{size:16,className:"animate-spin"}):e.jsx(T,{size:16}),o?"Save Changes":"Create Product"]})]})]})]})}export{le as default};
