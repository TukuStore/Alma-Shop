import{c as N,a as x,j as e,P as T,u as L,L as z,n as E,o as U,e as C,z as p,f as O}from"./index-B7VyGmnV.js";import{X as q}from"./x-B1ujcCVc.js";import{L as S}from"./loader-circle-DVE6fxfl.js";import{a as A,u as w}from"./orderService-BwYf6Fuo.js";import{A as R}from"./arrow-left-CyqdG89q.js";const $=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],D=N("circle-check",$);const G=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],F=N("circle",G);const K=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],H=N("copy",K);const V=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],P=N("external-link",V);const B=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],k=N("truck",B),I=[{value:"jne",label:"JNE"},{value:"jnt",label:"J&T Express"},{value:"sicepat",label:"SiCepat"},{value:"anteraja",label:"AnterAja"},{value:"tiki",label:"TIKI"},{value:"pos",label:"Pos Indonesia"},{value:"gojek",label:"Gojek (GoSend)"},{value:"grab",label:"Grab (GrabExpress)"},{value:"ninja",label:"Ninja Xpress"},{value:"other",label:"Lainnya"}];function J({open:i,onClose:s,onSubmit:f,isLoading:c,orderId:v}){const[l,d]=x.useState(""),[j,h]=x.useState(""),[o,b]=x.useState({});if(!i)return null;const _=()=>{const t={};return l||(t.courier="Pilih kurir pengiriman"),j.trim()||(t.trackingNumber="Masukkan nomor resi atau link tracking"),b(t),Object.keys(t).length===0},u=t=>{if(t.preventDefault(),!_())return;const r=I.find(a=>a.value===l)?.label??l;f(r,j.trim())},g=()=>{c||(d(""),h(""),b({}),s())};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:g}),e.jsxs("div",{className:"relative z-10 w-full max-w-md mx-4 bg-card border border-border rounded-2xl shadow-2xl animate-in fade-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(k,{size:20,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-foreground",children:"Kirim Pesanan"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Order #",v.slice(0,8).toUpperCase()]})]})]}),e.jsx("button",{onClick:g,disabled:c,className:"btn-ghost btn-icon",children:e.jsx(q,{size:18})})]}),e.jsxs("form",{onSubmit:u,className:"p-5 space-y-5",children:[e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Masukkan informasi pengiriman. Data ini akan ditampilkan kepada pelanggan untuk melacak pesanan mereka."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[e.jsx(T,{size:14,className:"text-muted-foreground"}),"Kurir Pengiriman ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("select",{value:l,onChange:t=>{d(t.target.value),b(r=>({...r,courier:void 0}))},className:`w-full h-10 px-3 rounded-lg border text-sm bg-secondary text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all ${o.courier?"border-red-400 ring-1 ring-red-400/30":"border-border"}`,children:[e.jsx("option",{value:"",children:"â€” Pilih Kurir â€”"}),I.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),o.courier&&e.jsx("p",{className:"text-xs text-red-400 font-medium",children:o.courier})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[e.jsx(k,{size:14,className:"text-muted-foreground"}),"No. Resi / Link Tracking ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:j,onChange:t=>{h(t.target.value),b(r=>({...r,trackingNumber:void 0}))},placeholder:"Contoh: JNE1234567890 atau https://gojek.link/...",className:`w-full h-10 px-3 rounded-lg border text-sm bg-secondary text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all ${o.trackingNumber?"border-red-400 ring-1 ring-red-400/30":"border-border"}`}),o.trackingNumber&&e.jsx("p",{className:"text-xs text-red-400 font-medium",children:o.trackingNumber}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"ðŸ’¡ Untuk Gojek/Grab, paste link live tracking langsung."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:g,disabled:c,className:"btn-ghost flex-1",children:"Batal"}),e.jsxs("button",{type:"submit",disabled:c,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[c?e.jsx(S,{size:14,className:"animate-spin"}):e.jsx(k,{size:14}),c?"Menyimpan...":"Kirim Sekarang"]})]})]})]})]})}const m=["pending","paid","processing","shipped","completed"],y={pending:"Pending Payment",paid:"Payment Confirmed",processing:"Processing",shipped:"Shipped",completed:"Completed",cancelled:"Cancelled",return_requested:"Return Requested",returned:"Returned"};function W(i){return i.startsWith("http://")||i.startsWith("https://")?i:`https://cekresi.com/?noresi=${encodeURIComponent(i)}`}function se(){const{id:i}=L(),[s,f]=x.useState(null),[c,v]=x.useState(!0),[l,d]=x.useState(!1),[j,h]=x.useState(!1);x.useEffect(()=>{i&&A(i).then(f).finally(()=>v(!1))},[i]);const o=async()=>{if(!s)return;const r=m.indexOf(s.status);if(r===-1||r>=m.length-1)return;const a=m[r+1];if(a==="shipped"){h(!0);return}d(!0);try{await w(s.id,a),f(n=>n&&{...n,status:a}),p.success(`Order status updated to "${y[a]}"`)}catch{p.error("Failed to update status")}finally{d(!1)}},b=async(r,a)=>{if(s){d(!0);try{await w(s.id,"shipped",{courier:r,tracking_number:a}),f(n=>n&&{...n,status:"shipped",courier:r,tracking_number:a}),p.success("Order shipped! Tracking info saved."),h(!1)}catch{p.error("Failed to update status")}finally{d(!1)}}},_=async()=>{if(!(!s||!confirm("Cancel this order?"))){d(!0);try{await w(s.id,"cancelled"),f(r=>r&&{...r,status:"cancelled"}),p.success("Order cancelled")}catch{p.error("Failed")}finally{d(!1)}}};if(c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{size:32,className:"animate-spin text-primary"})});if(!s)return e.jsx("div",{className:"text-center py-20 text-muted-foreground",children:"Order not found."});const u=m.indexOf(s.status),g=s.profile,t=s.order_items??[];return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{to:"/orders",className:"btn-ghost btn-icon",children:e.jsx(R,{size:18})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-foreground",children:["Order #",s.id.slice(0,8).toUpperCase()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:E(s.created_at)})]}),e.jsx("span",{className:`badge badge-${s.status} ml-auto`,children:y[s.status]})]}),!["cancelled","return_requested","returned"].includes(s.status)&&e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-5",children:"Order Progress"}),e.jsx("div",{className:"flex items-center gap-0",children:m.map((r,a)=>{const n=u>=a,M=u===a;return e.jsxs(U.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center flex-1 min-w-0",children:[e.jsx("div",{className:C("w-8 h-8 rounded-full flex items-center justify-center border-2 transition-all",n?"bg-primary border-primary":"border-border bg-secondary"),children:n?e.jsx(D,{size:16,className:"text-white",fill:"white"}):e.jsx(F,{size:16,className:"text-muted-foreground"})}),e.jsx("p",{className:C("text-[10px] mt-1.5 text-center leading-tight",M?"text-primary font-semibold":n?"text-foreground":"text-muted-foreground"),children:y[r]})]}),a<m.length-1&&e.jsx("div",{className:C("h-0.5 flex-1 -mt-5",a<u?"bg-primary":"bg-border")})]},r)})}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[u<m.length-1&&e.jsxs("button",{onClick:o,disabled:l,className:"btn-primary",children:[l?e.jsx(S,{size:14,className:"animate-spin"}):null,"Mark as ",y[m[u+1]]]}),!["cancelled","completed"].includes(s.status)&&e.jsx("button",{onClick:_,disabled:l,className:"btn-destructive",children:"Cancel Order"})]})]}),s.courier&&s.tracking_number&&["shipped","completed"].includes(s.status)&&e.jsxs("div",{className:"card border-primary/30 bg-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(k,{size:18,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-foreground",children:"Informasi Pengiriman"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Dikirim dengan ",e.jsx("span",{className:"font-semibold text-foreground",children:s.courier})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-secondary rounded-lg p-3 border border-border",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[10px] font-semibold text-muted-foreground uppercase tracking-wider mb-0.5",children:"No. Resi / Link Tracking"}),e.jsx("p",{className:"text-sm font-mono font-semibold text-foreground truncate",children:s.tracking_number})]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s.tracking_number),p.success("Copied!")},className:"btn-ghost btn-icon shrink-0",title:"Copy",children:e.jsx(H,{size:14})}),e.jsxs("a",{href:W(s.tracking_number),target:"_blank",rel:"noopener noreferrer",className:"btn-primary text-xs px-3 py-1.5 flex items-center gap-1 shrink-0",children:["Lacak ",e.jsx(P,{size:12})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground border-b border-border pb-2",children:"Customer"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:g?.full_name??"Unknown"}),e.jsx("p",{className:"text-muted-foreground",children:g?.phone_number??"â€”"})]}),e.jsxs(z,{to:`/users/${s.user_id}`,className:"flex items-center gap-1 text-xs text-primary hover:underline",children:["View Profile ",e.jsx(P,{size:10})]})]}),e.jsxs("div",{className:"card space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground border-b border-border pb-2",children:"Shipping Address"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.shipping_address||"No address provided"})]})]}),s.payment_proof_url&&e.jsxs("div",{className:"card space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground border-b border-border pb-2",children:"Payment Proof"}),e.jsx("a",{href:s.payment_proof_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:s.payment_proof_url,alt:"Payment proof",className:"max-h-64 rounded-lg object-contain border border-border hover:opacity-90 transition-opacity"})})]}),e.jsxs("div",{className:"card space-y-3",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground border-b border-border pb-2",children:["Items (",t.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[t.map(r=>e.jsxs("div",{className:"flex items-center gap-3",children:[r.product?.images?.[0]&&e.jsx("img",{src:r.product.images[0],alt:r.product.name,className:"w-12 h-12 rounded-md object-cover border border-border shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:r.product?.name??"Unknown"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",r.quantity]})]}),e.jsx("p",{className:"text-sm font-semibold text-foreground shrink-0",children:O(r.price_at_purchase*r.quantity)})]},r.id)),e.jsxs("div",{className:"border-t border-border pt-3 flex justify-between",children:[e.jsx("span",{className:"font-semibold text-sm text-foreground",children:"Total"}),e.jsx("span",{className:"font-bold text-foreground",children:O(s.total_amount)})]})]})]}),e.jsx(J,{open:j,onClose:()=>h(!1),onSubmit:b,isLoading:l,orderId:s.id})]})}export{se as default};
