import{u as S,m as V,a as n,j as e,L as x,z as d}from"./index-B7VyGmnV.js";import{_ as w,Z as z,u as D,a as L,o as C,s as c,c as E,b as A}from"./schemas-DS6lUYcu.js";import{g as R,u as F,c as P}from"./voucherService-CtTkvSPo.js";import{L as h}from"./loader-circle-DVE6fxfl.js";import{A as T}from"./arrow-left-CyqdG89q.js";import{S as k}from"./save-D7_vrgA4.js";function o(a){return w(z,a)}const q=C({code:c().min(2,"Code is required"),name:c().min(1,"Name is required"),description:c().optional(),discount_type:E(["percentage","fixed"]),discount_value:o().min(1),min_purchase:o().min(0),max_discount:o().optional(),start_date:c().min(1,"Start date required"),end_date:c().optional(),is_active:A()});function G(){const{id:a}=S(),j=V(),i=!!a,[m,u]=n.useState(!1),[N,g]=n.useState(i),{register:s,handleSubmit:b,watch:f,reset:v,formState:{errors:t}}=D({resolver:L(q),defaultValues:{discount_type:"percentage",is_active:!0,min_purchase:0}}),p=f("discount_type");n.useEffect(()=>{i&&a&&R().then(l=>{const r=l.find(y=>y.id===a);r&&v({...r,start_date:r.start_date?.split("T")[0]??"",end_date:r.end_date?.split("T")[0]??""}),g(!1)})},[a]);const _=async l=>{u(!0);try{i&&a?(await F(a,l),d.success("Voucher updated")):(await P(l),d.success("Voucher created")),j("/vouchers")}catch(r){d.error(r.message??"Failed")}finally{u(!1)}};return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(h,{size:32,className:"animate-spin text-primary"})}):e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{to:"/vouchers",className:"btn-ghost btn-icon",children:e.jsx(T,{size:18})}),e.jsx("h1",{className:"page-header mb-0",children:i?"Edit Voucher":"New Voucher"})]}),e.jsxs("form",{onSubmit:b(_),className:"card space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Voucher Code *"}),e.jsx("input",{...s("code"),className:"input uppercase",placeholder:"SARUNG20"}),t.code&&e.jsx("p",{className:"text-xs text-destructive",children:t.code.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Display Name *"}),e.jsx("input",{...s("name"),className:"input",placeholder:"20% Off Batik"}),t.name&&e.jsx("p",{className:"text-xs text-destructive",children:t.name.message})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{...s("description"),rows:2,className:"input resize-none",placeholder:"Optional description shown to users"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Discount Type *"}),e.jsxs("select",{...s("discount_type"),className:"select",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"fixed",children:"Fixed Amount (Rp)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Discount Value *"}),e.jsx("input",{...s("discount_value"),type:"number",className:"input",placeholder:p==="percentage"?"20":"50000"}),t.discount_value&&e.jsx("p",{className:"text-xs text-destructive",children:t.discount_value.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Minimum Purchase (Rp)"}),e.jsx("input",{...s("min_purchase"),type:"number",className:"input",placeholder:"100000"})]}),p==="percentage"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Max Discount Cap (Rp)"}),e.jsx("input",{...s("max_discount"),type:"number",className:"input",placeholder:"50000"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"Start Date *"}),e.jsx("input",{...s("start_date"),type:"date",className:"input"}),t.start_date&&e.jsx("p",{className:"text-xs text-destructive",children:t.start_date.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"label",children:"End Date"}),e.jsx("input",{...s("end_date"),type:"date",className:"input"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",...s("is_active"),className:"w-4 h-4 rounded accent-primary"}),e.jsx("span",{className:"text-sm text-foreground",children:"Active (visible to users)"})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2 border-t border-border",children:[e.jsx(x,{to:"/vouchers",className:"btn-secondary",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:m,className:"btn-primary",children:[m?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(k,{size:14}),i?"Update":"Create"," Voucher"]})]})]})]})}export{G as default};
