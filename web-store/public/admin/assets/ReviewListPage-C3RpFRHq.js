import{s as f,a as c,j as e,e as b,i as v,n as w,z as y}from"./index-B7VyGmnV.js";import{T as S}from"./trash-2-erq2rAW7.js";async function R(s){const n=s?.page??1,d=s?.limit,l=(n-1)*d;let a=f.from("reviews").select(`
      *,
      profile:profiles(full_name, avatar_url),
      product:products(id, name, images)
    `,{count:"exact"});s?.rating&&(a=a.eq("rating",s.rating)),a=a.order("created_at",{ascending:!1}).range(l,l+d-1);const{data:h,error:r,count:o}=await a;if(r)throw r;return{data:h??[],count:o??0}}async function C(s){const{error:n}=await f.from("reviews").delete().eq("id",s);if(n)throw n}function _(){const[s,n]=c.useState([]),[d,l]=c.useState(0),[a,h]=c.useState(),[r,o]=c.useState(1),[u,p]=c.useState(!0),j=20,g=c.useCallback(async()=>{p(!0);const{data:t,count:i}=await R({rating:a,page:r,limit:j});n(t),l(i),p(!1)},[a,r]);c.useEffect(()=>{g()},[g]);const N=async t=>{confirm("Delete this review?")&&(await C(t),y.success("Review deleted"),n(i=>i.filter(m=>m.id!==t)),l(i=>i-1))},x=Math.ceil(d/j);return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("h1",{className:"page-header",children:["Reviews ",e.jsxs("span",{className:"text-muted-foreground text-lg font-normal",children:["(",d,")"]})]}),e.jsx("div",{className:"flex gap-2",children:[void 0,5,4,3,2,1].map(t=>e.jsx("button",{onClick:()=>{h(t),o(1)},className:b("px-3 py-1.5 text-xs rounded-md font-medium transition-colors",a===t?"bg-primary/20 text-primary border border-primary/30":"btn-secondary"),children:t===void 0?"All Stars":`${t} ★`},String(t)))}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Comment"}),e.jsx("th",{children:"Date"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsxs("tbody",{children:[u&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-12 text-muted-foreground",children:"Loading..."})}),!u&&s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-12 text-muted-foreground",children:"No reviews found."})}),s.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"text-sm text-foreground",children:t.profile?.full_name??"Unknown"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.product?.images?.[0]&&e.jsx("img",{src:t.product.images[0],alt:"",className:"w-8 h-8 rounded object-cover border border-border"}),e.jsx("p",{className:"text-sm text-muted-foreground truncate max-w-[140px]",children:t.product?.name??"—"})]})}),e.jsx("td",{children:e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((i,m)=>e.jsx(v,{size:12,className:m<t.rating?"text-accent fill-accent":"text-border"},m))})}),e.jsx("td",{children:e.jsx("p",{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:t.comment})}),e.jsx("td",{children:e.jsx("span",{className:"text-xs text-muted-foreground",children:w(t.created_at)})}),e.jsx("td",{className:"text-right",children:e.jsx("button",{onClick:()=>N(t.id),className:"btn-ghost btn-icon text-destructive/70 hover:text-destructive",children:e.jsx(S,{size:15})})})]},t.id))]})]})}),x>1&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Page ",r," of ",x]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(t=>Math.max(1,t-1)),disabled:r===1,className:"btn-secondary px-3 py-1.5 text-xs",children:"Prev"}),e.jsx("button",{onClick:()=>o(t=>Math.min(x,t+1)),disabled:r===x,className:"btn-secondary px-3 py-1.5 text-xs",children:"Next"})]})]})]})}export{_ as default};
